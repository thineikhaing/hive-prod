var Carmic = {

    init: function() {

        handler = Gmaps.build('Google');
        handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
            markers = handler.addMarkers([
                {
                    "lat": 1.317907,
                    "lng": 103.843643,
                    "picture": {
                        "url": "http://localhost:5000/assets/Avatars/Chat-Avatar.png",
                        "width":  36,
                        "height": 36
                    },
                    "infowindow": "hello!"
                }
            ]);

 //           markers = handler.addMarkers(<%= @hash.to_json %>);
            console.log("<%= @hello %>");
            handler.addMarkers(<%= @hash.to_json %>);
            handler.bounds.extendWith(markers);
            handler.fitMapToBounds();


        });


        var directionsDisplay = new google.maps.DirectionsRenderer();
        var directionsService = new google.maps.DirectionsService();

        function calcRoute() {
          var origin      = new google.maps.LatLng(1.370016, 103.849449);
          var destination = new google.maps.LatLng(1.318089, 103.892982);
          var request = {
              origin:      origin,
              destination: destination,
              travelMode:  google.maps.TravelMode.DRIVING
          };
          directionsService.route(request, function(response, status) {
            if (status == google.maps.DirectionsStatus.OK) {
              directionsDisplay.setDirections(response);
            }
          });
        }

        calcRoute(); // call this anywhere you want

        var handler = Gmaps.build('Google');
        handler.buildMap({ internal: {id: 'map'}}, function(){
          directionsDisplay.setMap(handler.getMap());
        });


    }

};
